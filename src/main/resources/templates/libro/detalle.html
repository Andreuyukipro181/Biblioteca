<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Detalle de libro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container my-4">
    <a th:href="@{/catalogo/listado}" class="btn btn-link">&laquo; Volver al catálogo</a>

    <div class="row mt-3">
        <div class="col-md-4">
            <img th:if="${libro.urlImagenLibro != null}" th:src="${libro.urlImagenLibro}"
                 class="img-fluid" alt="Portada">
            <img th:if="${libro.urlImagenLibro == null}"
                 src="https://via.placeholder.com/300x200" class="img-fluid" alt="Portada">
        </div>
        <div class="col-md-8">
            <h2 th:text="${libro.titulo}">Título</h2>
            <p>Autor: <span th:text="${libro.autor != null ? libro.autor.nombre : 'Sin autor'}"></span></p>
            <p>Género: <span th:text="${libro.genero != null ? libro.genero.nombre : 'Sin género'}"></span></p>
            <p>Precio: ₡<span th:text="${libro.precio}">0</span></p>
            <p>Stock: <span th:text="${libro.stock}">0</span></p>
        </div>
    </div>

    <hr>

    <h4>Reseñas</h4>
    <div th:if="${#lists.isEmpty(resenas)}" class="alert alert-info">
        Aún no hay reseñas para este libro.
    </div>
    <div th:each="r : ${resenas}" class="mb-3 border rounded p-2">
        <strong th:text="${r.usuario.username}">usuario</strong>
        <span class="text-warning" th:text="${'*'.repeat(r.estrellas)}">***</span>
        <p th:text="${r.comentario}">Comentario</p>
    </div>

    <hr>

    <h5>Agregar reseña</h5>
    <form th:action="@{'/libro/' + ${libro.id} + '/resena'}" method="post">
        <div class="mb-3">
            <label class="form-label">Estrellas (1 a 5)</label>
            <input type="number" name="estrellas" class="form-control" min="1" max="5" required>
        </div>
        <div class="mb-3">
            <label class="form-label">Comentario</label>
            <textarea name="comentario" rows="3" class="form-control" required></textarea>
        </div>
        <button class="btn btn-primary" type="submit">Enviar reseña</button>
    </form>
</div>
</body>
</html>
